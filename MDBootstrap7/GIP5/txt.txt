<?php
    require("../header.php");

    if (!isset($_SESSION["admin"]) || $_SESSION["admin"] != 1) {
        header("Location: ../index.php");
        exit;   
    }

    require('pdo.php');
    require('../inc/config.php');
    require('../classes/class.smartschool.php');

    $ss = new Smartschool();
    $klasarray = $ss->ophalenKlassen();
    $isChecked = 0;
    $teller = 0;
    $deleted = false;

    $query = "SELECT g.idGeb, g.internNr , g.naam, g.voornaam, g.email, g.admin
              FROM `tblGebruiker` g, `tblAccounts` a 
              WHERE NOT g.`internNr` = (SELECT g.`internNr` FROM `tblGebruiker` g, `tblAccounts` a 
              WHERE g.`internNr` = a.`internnrGebruiker` AND `idPlatform` = 1)";

    try{
        $res = $pdo->prepare($query);
        $res->execute();
    }catch(PDOException $e){
        //error in de query
        die();
    }
    require('../startHTML.php');
?>
<style>
    .card {
        margin-left: 75px;
        margin-right: 75px; 
        margin-top: 40px;
    }
</style>
<?php require('../navbar.php'); ?>
<br><br>
<div class="card" id="card">
    <div class="col-sm-12">
        <div class="card-header bg-primary bg-gradient text-white">
            <h3 class="ml-5">Aanmaken linux accounts</h3>
        </div>    
        <div class="card-body">
            <table class="table table-hover table-striped">
                <tr>
                    <th class="fw-bold">Gebruikers</th>
                    <th class="fw-bold">Email</th>
                    <th class="fw-bold">Admin</th>
                    <th class="fw-bold">Update</th>
                </tr>
                <?php if ($res->rowCount() != 0) : ?>
                    <?php while($row = $res->fetch(PDO::FETCH_ASSOC)) : ?>
                        <?php $teller++;?>
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <input class="form-check-input shadow-sm rounded float-end" type="checkbox" name="leerlingen[]" value="<?php echo $row['internNr']?>" id="<?php echo $teller;?>" onclick="myFunction(this.id)">&ensp;
                                    <?php $foto = $ss->ophalenfoto($row['internNr']); ?>
                                    <img
                                    src="data:image/png;base64,<?php echo $foto; ?>" 
                                    class="rounded-circle" 
                                    height="50px" 
                                    width="50px"
                                    />
                                    <div class="ms-3">
                                        <p class="fw-bold mb-1"><?php echo $row['naam']; ?></p>
                                        <p class="text-muted mb-0"><?php echo $row['voornaam']; ?></p>
                                    </div>
                                </div>
                            </td>
                            <td><?php echo$row["email"]; ?> </td>
                            <td><?php echo$row["admin"] ? '<i class="fas fa-square-check text-success fs-5"></i>':
                                                            '<i class="far fa-square fs-5"></i>';?> </td>
                            <td>
                                <a href="userUpdate.php?id=<?php echo $row['idGeb']; ?>"><i class="fas fa-pen-to-square text-warning fs-5"  data-bs-toggle="tooltip" data-bs-placement="top" title="Wijzig gebruiker"></i></a>    
                            </td>
                        </tr>
                    <?php endwhile; ?>
                <?php else : ?>
                    <tr><td colspan="6">Geen gegevens gevonden</td></tr>
                <?php endif; ?>
            </table>
        </div>
    </div>
</div>    